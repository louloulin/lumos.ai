# Lumosai CLI 开发文档

## 概述

Lumosai CLI 是一个命令行工具，用于创建、开发、运行和部署 Lumosai AI 应用。该工具提供了一套完整的命令，使开发人员能够快速搭建人工智能项目、创建智能代理、管理工作流、以及部署应用程序。

## 命令功能

### Create 命令

创建新的 Lumosai 项目，支持多种功能:

1. **交互式项目名称选择**：如果未指定项目名称，将引导用户输入
2. **组件选择**：允许用户选择要包含的组件（代理、工作流、知识库等）
3. **LLM 提供商选择**：支持多种 LLM 提供商（OpenAI、Anthropic、本地模型等）
4. **API 密钥配置**：交互式配置所选 LLM 的 API 密钥
5. **项目结构初始化**：创建一个完整的项目结构，包括必要的配置文件和基础代码

### UI 命令

启动 Lumosai Web UI，用于可视化管理和运行 Lumosai 项目:

1. **服务器端口**：允许自定义服务器的端口号
2. **主题选择**：支持多种 UI 主题（暗色、亮色、自动）
3. **开发模式**：支持开发模式，实时重载更改
4. **API 服务器 URL**：可以连接到自定义的 API 服务器
5. **用户界面功能**：
   - **知识库管理**：支持文档上传、搜索和集合管理
   - **工作流编辑器**：可视化创建和编辑工作流程
   - **代理聊天界面**：与智能代理进行交互的界面
   - **响应式布局**：适配不同屏幕尺寸的设计

### Playground 命令

创建一个交互式测试环境，用于测试和调试 Lumosai 代理:

1. **端口配置**：配置测试服务器的端口
2. **代理指定**：可以指定要测试的特定代理
3. **会话历史**：保存测试会话的历史记录
4. **自定义 API URL**：支持连接到自定义的 API 服务器

### API 命令

生成 API 端点，允许通过 HTTP 请求访问智能代理:

1. **自动扫描**：自动扫描项目目录中的所有代理
2. **RESTful API 生成**：为每个代理生成标准的 RESTful API
3. **输出目录**：可以指定生成的 API 文件的输出目录
4. **代理过滤**：可以指定要为哪些代理生成 API

### Dev 命令

启动开发服务器，提供实时重载和开发环境:

1. **API 服务器**：启动 API 服务器
2. **UI 服务器**：可选择是否同时启动 UI 服务器
3. **文件监视**：监视文件更改并自动重新加载
4. **工具目录**：可以指定自定义工具的目录

### Visualize 命令

生成代理和工作流的可视化表示:

1. **导出格式**：支持多种导出格式（PNG、SVG、JSON）
2. **代理可视化**：可视化代理的结构和行为
3. **工作流可视化**：可视化工作流的步骤和连接
4. **性能数据**：可以包括性能数据的可视化

## 架构设计

Lumosai CLI 采用了模块化的架构设计，主要包括以下组件:

1. **命令处理器**：使用 `clap` 库处理命令行参数和子命令
2. **模板引擎**：生成项目结构和基础代码
3. **API 生成器**：基于 Swagger/OpenAPI 规范生成 API 端点
4. **UI 服务器**：提供 Web 界面，支持静态文件服务和 API 代理
5. **开发服务器**：提供热重载和开发环境支持
6. **可视化引擎**：生成代理和工作流的可视化表示

## 用户界面功能

Lumosai UI 提供了丰富的可视化功能，为开发者提供强大的 AI 应用管理体验:

### 1. 仪表盘页面（Dashboard）

提供系统概览和关键指标，帮助用户快速了解系统状态：

- **主要指标卡片**：展示代理调用次数、API请求数、令牌使用量和活跃用户等关键数据
- **资源概览**：显示系统中代理、工作流、文档和集合的数量统计
- **最近活动**：实时展示系统中的最新活动和事件
- **快速入门指南**：为新用户提供使用引导，快速上手平台功能
- **多标签页设计**：通过标签页组织概览、活动和资源信息，提供直观的导航体验

### 2. 代理聊天界面（Agent Chat）

提供与智能代理交互的界面，支持丰富的聊天功能：

- **代理选择器**：允许用户从多个可用代理中切换
- **代理信息面板**：显示当前代理的详细信息、能力和设置
- **消息列表**：以聊天气泡形式展示对话历史记录
- **代码块渲染**：自动识别并高亮显示代码块
- **文件上传**：支持向代理发送文件附件
- **输入框**：支持多行文本输入和Markdown格式
- **会话管理**：提供清除、导出对话功能
- **状态指示**：显示消息发送状态和代理正在输入的指示器

### 3. 知识库管理页面（Knowledge Base）

全面的文档管理系统，支持文档索引和组织：

- **文档上传与处理**：支持多种文档格式（PDF、Word、Excel 等）
- **集合管理**：创建和组织文档集合
- **文档搜索与筛选**：基于名称、类型、集合进行查找
- **文档状态追踪**：显示文档索引和处理状态
- **统计信息**：展示文档数量、存储大小等统计数据

### 4. 工作流编辑器（Workflow Editor）

可视化工作流设计工具，支持复杂流程的创建和管理：

- **可视化工作流设计**：直观创建和编辑工作流
- **多类型节点**：支持代理、条件、循环、输出等节点类型
- **节点配置**：详细配置每个节点的参数和行为
- **流程连接管理**：设置节点间的连接和转移条件
- **实时预览**：预览工作流执行路径

### 5. 工作流管理（Workflows）

管理现有工作流和创建新工作流：

- **工作流列表**：展示所有已创建的工作流，包括名称、描述和状态
- **创建新工作流**：提供创建新工作流的入口
- **工作流状态管理**：激活/暂停工作流运行
- **标签和分类**：使用标签对工作流进行分类和筛选
- **执行历史**：查看工作流的执行历史和结果

### 6. 代理管理（Agents）

查看和管理智能代理：

- **代理列表**：显示所有可用的代理及其状态
- **代理详情**：查看代理的详细信息和配置
- **创建代理**：提供创建新代理的界面
- **模型选择**：选择代理使用的底层语言模型
- **代理测试**：内置测试功能验证代理行为

### 7. 模型管理（Models）

管理和配置语言模型：

- **模型列表**：显示系统中可用的语言模型
- **模型详情**：查看模型参数和性能指标
- **API密钥管理**：管理模型API密钥
- **用量统计**：查看模型使用情况和成本

### 共通组件

UI 中使用的可复用组件：

- **响应式设计**：适配桌面和移动设备
- **主题支持**：亮色/暗色/自动主题切换
- **交互式表格**：支持排序、筛选的数据表格
- **文件上传组件**：支持拖放和多文件上传
- **语法高亮**：代码块的语法高亮显示
- **消息组件**：统一的消息格式化和显示
- **加载状态指示器**：提供一致的加载状态视觉反馈

## 测试

### 单元测试

为每个核心模块编写了单元测试，包括:

1. **命令测试**：测试各个命令的功能和参数处理
2. **模板测试**：测试项目模板的生成
3. **API 生成测试**：测试 API 端点的生成
4. **UI 组件测试**：测试 UI 组件的渲染和交互功能
   - **按钮组件**：测试不同变体和状态
   - **代理聊天组件**：测试消息发送、接收和显示功能
   - **知识库页面**：测试文档管理功能
   - **工作流编辑器**：测试工作流编辑功能
   - **仪表盘组件**：测试统计数据显示和交互

### 集成测试

进行了集成测试，确保各个组件能够协同工作:

1. **端到端测试**：测试整个工作流程，从项目创建到运行
2. **UI 集成测试**：测试用户界面的导航和功能集成
3. **API 集成测试**：测试生成的 API 端点的工作情况
4. **代理运行测试**：测试智能代理的运行和响应
5. **主题切换测试**：测试 UI 主题的切换功能
6. **响应式布局测试**：测试不同屏幕尺寸下的 UI 适配

## 依赖项

Lumosai CLI 使用了以下主要依赖项:

1. **clap**：用于命令行参数解析
2. **tokio**：用于异步运行时
3. **colored**：用于终端彩色输出
4. **dialoguer**：用于交互式命令行对话
5. **tempfile**：用于在测试期间创建临时文件和目录
6. **actix-web**：用于 API 和 UI 服务器
7. **actix-cors**：处理跨域请求
8. **serde**：数据序列化和反序列化
9. **react**：用于构建用户界面
10. **shadcn/ui**：提供现代化UI组件库
11. **lucide-react**：提供图标库
12. **vitest**：用于单元测试和组件测试
13. **testing-library**：用于测试 React 组件

## 未来工作

计划在未来版本中添加以下功能:

1. **增强错误处理**：提供更详细的错误信息和解决方案
2. **更多项目模板**：为 Create 命令添加更多项目模板
3. **扩展测试环境**：扩展 Playground 功能，支持多代理测试
4. **增强 API 生成**：支持更多 API 功能，如认证和速率限制
5. **更多集成测试**：添加更多集成测试场景
6. **UI 功能扩展**：
   - **实时性能监控**：添加实时性能监控仪表板
   - **多语言支持**：支持多种语言界面切换
   - **更丰富的数据可视化**：增加图表和可视化效果
   - **移动应用支持**：提供配套的移动应用
   - **协作功能**：支持多人协作编辑和管理
7. **知识库增强**：
   - **文档版本控制**：添加文档的版本历史管理
   - **高级搜索功能**：支持语义搜索和相似度查询
   - **文档内容预览**：直接预览文档内容
   - **自动摘要生成**：为上传的文档自动生成摘要
8. **工作流功能增强**：
   - **工作流调试工具**：提供实时调试和步骤跟踪
   - **历史执行记录**：记录详细的执行历史
   - **性能优化建议**：根据执行数据提供优化建议
   - **版本控制**：对工作流变更进行版本管理
9. **代理功能增强**：
   - **多模态支持**：增加图像、音频处理能力
   - **记忆优化**：改进代理的长期记忆能力
   - **插件系统**：支持第三方插件扩展代理功能
   - **反馈学习**：基于用户反馈优化代理行为 